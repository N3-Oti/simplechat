# 解説書 (初心者向け改訂版)

## 1. プロジェクト概要：なぜこのチャットボットを作ったの？

**「もっと気軽に AI と話せたら面白いんじゃない？」**

最近、ChatGPT のような賢い AI (人工知能) と会話できるサービスがたくさん登場していますよね。このプロジェクトは、「Amazon Bedrock」という AWS (Amazon Web Services) が提供する様々な AI モデルを利用して、自分だけのオリジナルチャットボットアプリケーションを作ってみよう！という試みから生まれました。

**このプロジェクトの目的:**

*   **AI との対話:** Amazon Bedrock が提供する大規模言語モデル (LLM) を使って、人間と自然な会話ができるチャット機能を実現します。
*   **安全な利用:** 誰でも使えるのではなく、ちゃんとアカウント登録（サインアップ）してログイン（サインイン）した人だけが使えるように、Amazon Cognito というサービスでユーザー認証機能を付けます。これにより、安心して利用できる環境を提供します。
*   **モダンなウェブ技術の活用:** フロントエンド（ユーザーが見る画面）は React という人気の技術で作成し、バックエンド（裏方の処理）は AWS Lambda というサーバーレス技術を使います。これにより、効率的でスケーラブル（利用者が増えても対応しやすい）なシステムを目指します。
*   **インフラの自動化:** AWS の様々なサービスを組み合わせてシステムを構築しますが、その設定作業を AWS CDK というツールを使って「コード」で記述します。これにより、手作業によるミスを防ぎ、同じ環境を何度でも正確に再現できるようにします (Infrastructure as Code = IaC)。

**完成イメージ:**

ユーザーはウェブブラウザからチャット画面にアクセスし、ログインします。ログイン後、メッセージを入力すると、裏側で AWS Lambda が Amazon Bedrock の AI モデルを呼び出し、応答を生成して画面に表示します。この一連の流れを、AWS の様々なサービスが連携して実現しています。

## 2. アーキテクチャ解説：システムの仕組みはどうなってるの？

このチャットボットは、いくつかの AWS サービスが連携して動作しています。レストランの運営に例えながら、全体の流れを見ていきましょう。

![アーキテクチャ図](architecture.png)
*(この図はシステムの構成要素とそのつながりを示しています)*

**登場人物 (AWS サービス):**

1.  **ユーザー (あなた):** レストランのお客さん。チャットボットと会話したい人。
2.  **ウェブブラウザ:** お客さんが使う端末 (PC やスマホ)。
3.  **Amazon CloudFront (高速配達員):** レストランの入り口でメニューや内装の情報を素早く届ける係。世界中に拠点があり、一番近いところから情報を届けます。
4.  **Amazon S3 (倉庫):** レストランのメニュー表や内装データ（ウェブサイトのファイル）を保管している大容量倉庫。
5.  **Amazon Cognito (会員証発行所 & 受付):**
    *   初めてのお客さんに会員証を発行（サインアップ）。
    *   会員証を持っているお客さんを確認して入店許可（サインイン）。
    *   入店時（API アクセス時）に会員証 (ID Token) を確認する役割も担います。
6.  **Amazon API Gateway (総合受付 & 案内係):**
    *   お客さん（ブラウザ）からの注文（API リクエスト）を受け取る総合受付。
    *   会員証 (ID Token) をチェックして、正当な注文か確認（認証）。
    *   注文内容に応じて、適切なキッチン（Lambda 関数）へ案内（ルーティング）。
7.  **AWS Lambda - `ChatFunction` (メインシェフ):**
    *   案内係 (API Gateway) から注文（ユーザーのメッセージと会話履歴）を受け取る。
    *   専門家 (Bedrock) にレシピ（プロンプト）を渡して、料理（応答メッセージ）を作ってもらうよう依頼。
    *   出来上がった料理（応答）を案内係 (API Gateway) に返す。
8.  **Amazon Bedrock (AI の専門家):**
    *   メインシェフ (Lambda) から依頼されたレシピ（プロンプト）に基づいて、最高の料理（チャット応答）を考案・生成する AI 頭脳。
9.  **(舞台裏の準備係)**
    *   **AWS CDK (設計・建設ツール):** レストラン全体（AWS のインフラ）の設計図をコードで書き、自動で建設・改修するツール。
    *   **AWS Lambda - `ConfigGeneratorFunction` (設定ファイル準備係):** レストラン開店準備（デプロイ時）に、メインシェフや案内係が必要とする情報（API の場所など）を書いたメモ (`config.js`) を作成し、倉庫 (S3) に置く係。

**処理の流れ (ユーザーがメッセージを送って応答が返るまで):**

1.  **来店 & メニュー表示:**
    *   ユーザーがブラウザでチャットボットの URL にアクセスします。
    *   CloudFront (高速配達員) が、一番近い拠点から S3 (倉庫) に保管されているウェブサイトのファイル (HTML, CSS, JS) を素早くブラウザに届けます。
2.  **会員確認 (ログイン):**
    *   画面に Cognito (会員証発行所) が提供するログインフォームが表示されます (Amplify UI の Authenticator)。
    *   ユーザーがメールアドレスとパスワードを入力してログインします。
    *   Cognito が認証を行い、成功すると「デジタル会員証」([ID Token](#id-token-cognito)) をブラウザに発行します。
3.  **チャット開始 & 注文:**
    *   ログイン後、チャット画面が表示されます。
    *   ユーザーがメッセージを入力し、送信ボタンを押します。
    *   ブラウザ (React アプリ) は、入力されたメッセージと、これまでの会話履歴、そして Cognito からもらった会員証 (ID Token) を添えて、API Gateway (総合受付) に「チャット応答をください！」という注文 (POST リクエスト) を送ります (axios を使用)。
4.  **受付 & 案内:**
    *   API Gateway (総合受付) は注文を受け取ります。
    *   まず、添えられた会員証 (ID Token) を Cognito (受付) に照会し、有効なものか（認証済みユーザーか）を確認します。
    *   確認できたら、注文内容 (メッセージ、会話履歴) をメインシェフ (`ChatFunction` Lambda) に渡します。
5.  **調理依頼:**
    *   メインシェフ (`ChatFunction` Lambda) は注文を受け取ります。
    *   ユーザーのメッセージと会話履歴を、AI の専門家 (Bedrock) が理解できる形式の「レシピ」（API リクエストボディ）にまとめます。
    *   Boto3 (専用リモコン) を使って、Bedrock に「このレシピで応答を作って！」と依頼 (`invoke_model`) します。
6.  **AI が応答生成:**
    *   AI の専門家 (Bedrock) は、依頼されたレシピ（プロンプト、会話履歴、推論パラメータ）に基づいて、最適な応答メッセージを生成します。
7.  **応答の受け渡し:**
    *   Bedrock は生成した応答をメインシェフ (Lambda) に返します。
    *   メインシェフ (Lambda) は、受け取った応答と、更新された会話履歴（今回の応答を含む）をまとめて、案内係 (API Gateway) に返します。
8.  **お客さんへ提供:**
    *   案内係 (API Gateway) は、シェフから受け取った応答を、注文元であるブラウザ (React アプリ) に返します。
    *   ブラウザ (React アプリ) は、受け取った応答メッセージを画面に表示します。会話履歴も更新されます。

このように、様々なサービスがそれぞれの役割を果たし、連携することでチャットボットが機能しています。CDK を使うことで、これらのサービスの複雑な設定や連携をコードで管理し、自動で構築できるようになっているのがポイントです。

## 3. 技術スタック：何を使って作られているの？

このチャットボットを作るために、様々な技術や AWS サービスが使われています。専門用語が多いですが、ここでは簡単に紹介します。詳細は[用語集](#用語集)も参照してください。

*   **バックエンド (舞台裏の処理):**
    *   **コンピューティング (計算・処理):** [AWS Lambda](#aws-lambda) (Python)
        *   サーバー管理不要でプログラムを実行する仕組み。ユーザーのリクエストに応じてチャット応答を生成します。
    *   **AI/ML (人工知能):** [Amazon Bedrock](#amazon-bedrock)
        *   様々な高性能 AI モデル (LLM) を簡単に使えるサービス。チャットの「頭脳」です。
    *   **認証 (本人確認):** [Amazon Cognito](#amazon-cognito)
        *   ユーザーのログインやアカウント管理を行うサービス。「会員証発行所」です。
    *   **API (サービスの窓口):** [Amazon API Gateway](#amazon-api-gateway)
        *   外部からのリクエストを受け付け、認証し、適切な Lambda 関数につなぐ「総合受付」。
*   **フロントエンド (ユーザーが見る画面):**
    *   **フレームワーク (開発の骨組み):** [React](#react) (JavaScript)
        *   ユーザーインターフェースを効率的に作るための人気ライブラリ。
    *   **ホスティング (置き場所):** [Amazon S3](#amazon-s3-simple-storage-service)
        *   React で作られたウェブサイトのファイル（HTML, CSS, JS）を保管する「オンライン倉庫」。
    *   **CDN (高速配達):** [Amazon CloudFront](#amazon-cloudfront)
        *   S3 にあるファイルを、世界中のユーザーに素早く届けるための「高速配達ネットワーク」。
*   **インフラストラクチャ (システムの土台) のコード化 (IaC):**
    *   **[AWS CDK](#aws-cdk-cloud-development-kit)** (TypeScript, Node.js)
        *   上記のような AWS サービスの設定や連携を、プログラムコード (TypeScript) で記述し、自動で構築・管理するツール。「インフラの設計図」をコードで書きます。
*   **その他:**
    *   **バージョン管理:** Git (GitHub)
        *   プログラムコードの変更履歴を記録・管理するシステム。
    *   **パッケージ管理:**
        *   [npm](#npm-node-package-manager) (Node.js 用): CDK や React が使う部品 (ライブラリ) を管理。
        *   pip (Python 用): Lambda 関数 (Python) が使う部品 (ライブラリ) を管理 ([requirements.txt](#requirementstxt))。

これらの技術を組み合わせることで、安全で、高機能で、効率的に動作するチャットボットアプリケーションを実現しています。

## 4. セットアップと実行方法：どうやって動かすの？

このチャットボットを自分の AWS 環境で動かすための手順です。コマンドライン操作に慣れていない場合は少し難しく感じるかもしれませんが、手順通りに進めれば大丈夫です。

**事前に必要な準備:**

*   **AWS アカウント:** もし持っていなければ作成してください。
*   **AWS CLI:** AWS をコマンドラインから操作するためのツール。インストールと初期設定（認証情報の設定）が必要です。
*   **Node.js と npm:** [AWS CDK](#aws-cdk-cloud-development-kit) やフロントエンド開発に必要なツール。[Node.js](https://nodejs.org/) の公式サイトから LTS 版をインストールしてください (npm は通常 Node.js に含まれます)。
*   **Git:** コードをダウンロードするために必要です。[Git](https://git-scm.com/) の公式サイトからインストールしてください。
*   **Python:** バックエンドの Lambda 関数を実行するために必要です。Python 3.9 以上が推奨されます。
*   **AWS CDK Toolkit:** `npm install -g aws-cdk` コマンドでインストールできます。
*   **Bedrock モデルアクセス許可:** **重要！** AWS マネジメントコンソールにログインし、Bedrock の管理画面から、使用したいモデル (デフォルトでは `amazon.titan-text-express-v1` または `amazon.titan-text-lite-v1`) へのアクセス許可を有効にしておく必要があります。詳細は `simplechat/README.md` (元のファイル) の「Bedrockモデルアクセス許可の設定」セクションを参照してください。

**セットアップ手順:**

1.  **リポジトリのクローン (コードのダウンロード):**
    ```bash
    # Git を使って、GitHub からプロジェクトのコード一式を自分の PC にコピーします。
    git clone https://github.com/keisskaws/simplechat
    # コピーしたプロジェクトのフォルダに移動します。
    cd simplechat
    ```
2.  **依存関係のインストール & フロントエンドビルド:**
    ```bash
    # npm を使って、プロジェクトが必要とするプログラム部品 (ライブラリ) を
    # インターネットからダウンロードして準備します。
    # (ルートとフロントエンドの両方の部品がインストールされ、
    #  さらにフロントエンドのビルド (公開用ファイルの作成) も自動で行われます)
    npm install
    ```
3.  **AWS アカウントのブートストラップ (初回のみ):**
    *   もし、この AWS アカウントとリージョンで初めて CDK を使う場合は、以下のコマンドを実行して CDK が動作するための準備を行います。
    ```bash
    # CDK が AWS 環境にリソースを作成するために必要な
    # 基本的なインフラ (S3 バケットなど) を準備するコマンドです。
    # 各 AWS アカウント・リージョンごとに一度だけ実行が必要です。
    npx cdk bootstrap
    ```
4.  **CDK スタックのデプロイ (AWS への構築):**
    ```bash
    # CDK を使って、コードで定義されたインフラストラクチャ
    # (Cognito, S3, Lambda, API Gateway など) を
    # 実際に AWS クラウド上に作成（デプロイ）します。
    # AWS リソースが作成されるため、料金が発生する可能性があります。
    npx cdk deploy
    ```
    *   デプロイ中に、IAM (権限) に関する変更などについて確認を求められる場合があります。内容を確認し、問題なければ `y` を入力して進めてください。
    *   デプロイが完了すると、コマンドラインに `Outputs:` として CloudFront の URL などが表示されます。

5.  **アプリケーションへのアクセス:**
    *   デプロイ完了後に出力された `BedrockChatbotStack.CloudFrontURL` の値 (例: `https://d12345abcdef.cloudfront.net`) をウェブブラウザで開きます。
    *   Cognito のログイン画面が表示されるので、「アカウント作成」から新しいユーザーを登録し、そのユーザーでログインしてください。
    *   ログイン後、チャット画面が表示され、AI との対話を開始できます。

**クリーンアップ (後片付け):**
チャットボットが不要になったら、以下のコマンドを実行して AWS 上に作成されたリソースを削除し、意図しない課金を防ぎましょう。
```bash
# CDK で作成した AWS リソース一式を削除します。
# S3 バケットの中身なども削除される設定になっている場合がありますので注意してください。
npx cdk destroy
```

## 5. ディレクトリ構造：プロジェクトの中身はどうなってる？

プロジェクトのフォルダ (`simplechat/`) の中には、いくつかのサブフォルダやファイルがあります。それぞれの役割を簡単に説明します。

```
simplechat/
├── bin/              # CDK アプリの起動スクリプト (TypeScript) が入っています。
│   └── bedrock-chatbot.ts # CDK のエントリーポイント。ここから処理が始まります。
├── frontend/         # フロントエンド (ユーザーが見る画面、React アプリ) のコードが入っています。
│   ├── node_modules/ # フロントエンドが使う部品 (npm でインストールされたもの)。(通常 Git 管理外)
│   ├── public/       # index.html や画像など、公開される静的ファイル。
│   │   └── index.html # React アプリが埋め込まれる基本の HTML ページ。
│   └── src/          # React コンポーネントや CSS など、画面を作るための主要なコード。
│       ├── App.js      # メインの React コンポーネント。認証とチャット UI を担当。
│       ├── App.css     # App.js 用のスタイルシート。
│       ├── index.js    # React アプリを起動するエントリーポイント。
│       └── index.css   # アプリ全体に適用される基本的なスタイルシート。
├── lambda/           # バックエンド (裏方処理) の AWS Lambda 関数のコードが入っています。
│   ├── index.py      # チャット応答を生成するメインの Lambda 関数 (Python)。
│   └── requirements.txt # ↑の Python コードが必要とするライブラリのリスト。
├── lib/              # AWS CDK でインフラを定義するコード (スタック定義) が入っています。
│   └── bedrock-chatbot-stack.ts # Cognito, S3, Lambda, API Gateway などの AWS リソースを定義する TypeScript コード。
├── node_modules/     # CDK など、プロジェクト全体 (ルート) で使う部品。(通常 Git 管理外)
├── .gitignore        # Git のバージョン管理から除外するファイルやフォルダを指定する設定ファイル。
├── architecture.png  # この解説書でも使われているアーキテクチャ図の画像ファイル。
├── cdk.json          # CDK ツール自体の設定ファイル。
├── package.json      # プロジェクト全体 (ルート) の設定ファイル。使う部品 (依存関係) やコマンド (scripts) を定義 (Node.js/npm 用)。
├── package-lock.json # 実際にインストールされた部品の正確なバージョンを記録するファイル (npm が自動生成)。
├── README.md         # プロジェクトの元々の説明ファイル (英語)。
├── tsconfig.json     # TypeScript コードを JavaScript に変換する際のルールを定義する設定ファイル。
├── 解説書.md         # このファイル。プロジェクトを理解するための解説。
└── 用語集.md         # プロジェクトで使われる専門用語の解説。
```

このように、役割ごとにフォルダが分かれており、どこに何があるか分かりやすくなっています。

## 6. 主要ファイル/モジュール詳細解説

ここでは、プロジェクトの中でも特に重要なファイルについて、もう少し詳しく解説します。

*(注意: 以下の解説は初心者向けに記述されており、技術的な厳密さよりも分かりやすさを優先しています。より正確な情報は[用語集](#用語集)やコード自体を参照してください。)*

### `simplechat/bin/bedrock-chatbot.ts` (CDK アプリの出発点)

*   **役割:** [AWS CDK](#aws-cdk-cloud-development-kit) を使ってインフラを構築する際の、「最初の指示書」となるファイルです。`cdk deploy` コマンドを実行したときに、まずこのファイルが読み込まれます。
*   **何をしているか:**
    1.  必要な部品 (CDK ライブラリや、次に説明する `bedrock-chatbot-stack.ts`) を読み込みます。
    2.  「CDK アプリケーション」という全体を管理するオブジェクトを作成します。
    3.  `lib/bedrock-chatbot-stack.ts` で定義されている `BedrockChatbotStack` (インフラ全体の設計図) を呼び出して、実際にインフラを作る準備をします。このとき、どの Bedrock モデルを使うか (`modelId`) などの設定情報を渡します。
    4.  作成される AWS リソース全体に、「これは SimpleChat プロジェクトの一部ですよ」といった共通の[タグ](#tags-タグ) (ラベル) を付けます。

### `simplechat/lib/bedrock-chatbot-stack.ts` (インフラ全体の設計図)

*   **役割:** このプロジェクトに必要な **AWS のインフラ部品すべて**を、[AWS CDK](#aws-cdk-cloud-development-kit) のコード (TypeScript) で定義している、まさに「インフラ全体の設計図」ファイルです。
*   **何をしているか (定義されている主な部品):**
    1.  **[Amazon Cognito](#amazon-cognito):**
        *   `ChatbotUserPool`: ユーザーアカウントを管理する「会員名簿」。誰でも登録できるか、パスワードのルールなどを設定。
        *   `ChatbotUserPoolClient`: フロントエンドアプリが↑の会員名簿にアクセスするための「専用窓口」。認証方法などを設定。
    2.  **[Amazon S3](#amazon-s3-simple-storage-service):**
        *   `WebsiteBucket`: フロントエンドのウェブサイトファイル (React アプリのビルド結果) を保管する「倉庫」。
    3.  **[Amazon CloudFront](#amazon-cloudfront):**
        *   `Distribution`: ↑の S3 倉庫からファイルをユーザーに届ける「高速配達ネットワーク」の設定。HTTPS 強制やキャッシュルールなどを定義。
    4.  **[AWS Lambda](#aws-lambda) と [IAM](#iam-identity-and-access-management) (権限):**
        *   `ChatLambdaRole`: チャット処理 Lambda (`ChatFunction`) が Bedrock などにアクセスするための「権限セット」。
        *   `ChatFunction`: ユーザーのメッセージを受け取り、Bedrock と会話して応答を返す Python プログラム (Lambda 関数)。
        *   `ConfigGeneratorRole`: 設定ファイル生成 Lambda (`ConfigGeneratorFunction`) が S3 や CloudFront にアクセスするための「権限セット」。
        *   `ConfigGeneratorFunction`: デプロイ時にフロントエンド用設定ファイル (`config.js`) を自動生成して S3 に置く Node.js プログラム (Lambda 関数)。
    5.  **[Amazon API Gateway](#amazon-api-gateway):**
        *   `ChatbotApi`: フロントエンドからのリクエストを受け付ける「総合受付」。
        *   `ChatbotAuthorizer`: ↑の受付で Cognito を使ってユーザー認証を行う仕組み。
        *   `/chat` エンドポイント: チャットリクエストを受け付け、認証後に `ChatFunction` Lambda に繋ぐための具体的な「窓口」。
    6.  **その他 (CDK の補助機能):**
        *   `Custom Resource` (設定ファイル生成の実行): デプロイ中に `ConfigGeneratorFunction` Lambda を実行させるための仕組み。
        *   `S3 Bucket Deployment` (ファイルアップロード): ローカルの `frontend/build` フォルダの中身を S3 バケットに自動でアップロードする仕組み。
*   **出力:** デプロイ完了後、CloudFront の URL など、アクセスに必要な情報が表示されるように設定されています。

### `simplechat/lambda/index.py` (チャット応答生成のメインシェフ)

*   **役割:** バックエンドで実際にチャットの応答を生成する処理を担当する [AWS Lambda](#aws-lambda) 関数の Python コードです。[API Gateway](#amazon-api-gateway) から呼び出されます。
*   **何をしているか:**
    1.  **初期化:** 必要なライブラリ (AWS を操作する [Boto3](#boto3) など) を読み込み、[Amazon Bedrock](#amazon-bedrock) と通信するための準備をします。どの AI モデルを使うかは環境変数 `MODEL_ID` から取得します。
    2.  **リクエスト受信:** API Gateway から、ユーザーが入力したメッセージ (`message`) と、それまでの[会話履歴](#conversation-history) を受け取ります。誰からのリクエストかも確認します (Cognito 認証情報)。
    3.  **Bedrock への依頼準備:** 受け取ったメッセージと会話履歴を、Bedrock の AI モデルが理解しやすい形式に整えます。応答の長さや創造性を調整する[パラメータ](#inference-parameters-bedrock)も設定します。
    4.  **Bedrock 呼び出し:** Boto3 を使って Bedrock の `invoke_model` API を呼び出し、「この内容で応答を生成してください」と依頼します。
    5.  **応答処理:** Bedrock から返ってきた AI の応答を取り出し、会話履歴にその応答を追加します。
    6.  **フロントエンドへの返却:** 成功したこと、AI の応答、更新された会話履歴をまとめて、API Gateway 経由でフロントエンドのブラウザに返します。
    7.  **エラー対応:** もし途中で何か問題が起きたら、エラー情報を記録し、フロントエンドにエラーが発生したことを伝えます。

### `simplechat/frontend/src/App.js` (チャット画面の司令塔)

*   **役割:** [React](#react) で作られたフロントエンド (ユーザーが見る画面) の中心となるファイルです。ログイン画面の表示、チャット UI の表示、ユーザー操作への対応、バックエンド API との通信などを担当します。
*   **何をしているか:**
    1.  **設定読み込み (`loadConfig`)**: アプリが動作するために必要な設定情報 (API の場所、Cognito の ID など) を、デプロイ時に生成された [`config.js`](#configjs-frontend) または環境変数から読み込みます。
    2.  **Amplify 初期化**: 読み込んだ設定を使って [AWS Amplify](#aws-amplify) ライブラリを初期化します。これで Amplify が正しい Cognito や API Gateway と通信できるようになります。
    3.  **認証画面表示 (`App` コンポーネント & `Authenticator`):**
        *   `<Authenticator>` という Amplify の部品を使って、ログイン画面を表示します。
        *   ユーザーがログインに成功すると、Authenticator は内部に書かれた `ChatInterface` コンポーネントを表示します。ログアウト機能やユーザー情報も `ChatInterface` に渡します。
    4.  **チャット UI 表示と操作 (`ChatInterface` コンポーネント):**
        *   **状態管理 (`useState`):** チャットのメッセージ履歴 (`messages`), ユーザーの入力内容 (`input`), API 通信中かどうかのフラグ (`loading`), エラー情報 (`error`) などを [State](#state-react) として記憶・管理します。
        *   **画面描画 (`return` 内の JSX):** 記憶している State に基づいて、チャットのヘッダー、メッセージリスト、入力フォームなどを画面に表示します。ローディング中やエラー発生時の表示も切り替えます。
        *   **ユーザー操作への対応 (イベントハンドラー):**
            *   `handleSubmit`: メッセージ送信時に実行。Cognito から [ID Token](#id-token-cognito) を取得し、メッセージと会話履歴と共にバックエンド API ([axios](#axios) を使用) に送信します。応答を受け取って `messages` State を更新します。
            *   `clearConversation`: 会話クリアボタンで `messages` State を空にします。
            *   テキストエリアへの入力や Enter キーでの送信処理も担当します。
        *   **自動スクロール (`useEffect`, `useRef`):** 新しいメッセージが追加されたら、自動的に画面が一番下までスクロールするようにします ([Effect Hook](#effect-hook-useeffect), [Ref Hook](#ref-hook-useref) を使用)。

### `simplechat/lambda/requirements.txt` (Python の部品リスト)

*   **役割:** 上記の `index.py` (Python Lambda 関数) が動作するために必要な外部ライブラリ (部品) の名前とバージョンが書かれたリストです。
*   **内容:** 主に AWS SDK for Python である [Boto3](#boto3) と、そのコアライブラリである `botocore` のバージョンが指定されています。Lambda 関数をデプロイする際に、このリストに基づいて必要なライブラリが準備されます。

### `simplechat/cdk.json` (CDK ツールの設定ファイル)

*   **役割:** [AWS CDK](#aws-cdk-cloud-development-kit) ツール自体が、このプロジェクトをどのように扱うかの設定が書かれたファイルです。
*   **主な設定:**
    *   `app`: CDK がインフラ定義コードを実行する際のコマンド (どのファイルから開始するか)。ここでは `ts-node` を使って `bin/bedrock-chatbot.ts` を直接実行するように指定されています。
    *   `context`: CDK の特定の機能や挙動を制御するための[機能フラグ](#feature-flag-cdk)が多数設定されています。これにより、CDK の推奨設定が適用され、安定性が向上します。

### `simplechat/package.json` (プロジェクト全体の部品リストとコマンド集 @ルート)

*   **役割:** プロジェクトのルートディレクトリにある、[Node.js](#nodejs) プロジェクトとしての設定ファイルです。主に [AWS CDK](#aws-cdk-cloud-development-kit) 関連の部品リストと、プロジェクト全体のビルドやデプロイを行うためのコマンド ([scripts](#scripts-npm)) が定義されています。
*   **主な設定:**
    *   `dependencies`: CDK アプリの実行に必要なライブラリ (`aws-cdk-lib` など)。
    *   `devDependencies`: CDK の開発や TypeScript のコンパイル、テストに必要なツール (`aws-cdk`, `typescript`, `jest`, `ts-node` など)。
    *   `scripts`: `npm run build` (TypeScript コンパイル), `npm run deploy` (CDK デプロイ), `npm run test` (テスト実行) などのショートカットコマンド。
    *   `postinstall`: `npm install` 直後に自動実行されるスクリプト。ここではフロントエンドのインストールとビルドを自動化しています。

### `simplechat/frontend/package.json` (フロントエンドの部品リストとコマンド集)

*   **役割:** `simplechat/frontend/` ディレクトリにある、[React](#react) フロントエンドアプリ固有の設定ファイルです。フロントエンドが使う部品リストや、開発サーバー起動・ビルド用のコマンドが定義されています。
*   **主な設定:**
    *   `dependencies`: React アプリの実行に必要なライブラリ ([React](#react), [axios](#axios), [AWS Amplify](#aws-amplify) など)。[React Testing Library](#react-testing-library-testing-libraryreact) も含まれます。
    *   `scripts`: `npm start` (開発サーバー起動), `npm run build` (本番用ファイル作成), `npm test` (テスト実行) など。[react-scripts](#react-scripts-react-scripts) を利用しています。
    *   `eslintConfig`: コードチェックツール [ESLint](#eslint) の設定。
    *   `browserslist`: 対応するブラウザの範囲指定。

### `simplechat/frontend/public/index.html` (ウェブページの骨格)

*   **役割:** ブラウザで最初に読み込まれる HTML ファイルです。React アプリケーションが描画されるための土台 (`<div id="root">`) を提供します。
*   **ポイント:** このファイルは静的ですが、CDK デプロイ時に Lambda 関数によって `<script src="/config.js"></script>` タグが自動的に挿入され、アプリケーションが設定情報を読み込めるようになります。

### `simplechat/frontend/src/index.js` (React アプリの起動点)

*   **役割:** React アプリケーションを実際に起動し、`public/index.html` の `<div id="root">` にメインコンポーネント (`App.js` の `<App />`) を描画する JavaScript ファイルです。

### `simplechat/frontend/src/App.css` & `src/index.css` (見た目の設定)

*   **役割:** アプリケーションの見た目（レイアウト、色、フォントなど）を設定する CSS ファイルです。`index.css` は全体的な基本スタイル、`App.css` は `App.js` 内のコンポーネント固有のスタイルや Amplify UI のカスタマイズを担当します。

## 7. 全体的な処理フロー (まとめ)

ユーザーがチャットボットと会話する際の、裏側の主要な流れをもう一度おさらいします。

1.  **アクセス & 画面表示:** ユーザーが URL にアクセスすると、CloudFront → S3 を経由して React で作られたチャット画面のファイルがブラウザに読み込まれます。
2.  **ログイン:** Cognito と Amplify を使ってユーザー認証が行われ、成功すると ID Token が発行されます。
3.  **メッセージ送信:** ユーザーがメッセージを入力すると、React アプリ (axios) が ID Token を付けて API Gateway にリクエストを送ります。
4.  **認証 & 転送:** API Gateway は ID Token を Cognito で検証し、OK ならリクエストを Lambda (`ChatFunction`) に転送します。
5.  **AI 応答生成:** Lambda (`ChatFunction`) は受け取ったメッセージと会話履歴を Bedrock に送り、応答を生成させます (Boto3 を使用)。
6.  **応答返却:** Bedrock からの応答を Lambda が受け取り、API Gateway → React アプリ へと返し、画面に表示されます。

この一連の処理が、ユーザーがメッセージを送るたびに繰り返されます。

## 8. この解説書について

この解説書は、`simplechat` リポジトリのコードを、特にソフトウェア開発の経験がない初心者の方でも理解できるように、自動生成プロセスとその後の手動調整によって作成・改訂されました。

各ソースコードファイルの詳細な解説は「6. 主要ファイル/モジュール詳細解説」セクションに、プロジェクト内で使用される専門用語の解説は [`用語集.md`](#用語集) に記載されています。

**目指したこと:**

*   単に「何が書かれているか」だけでなく、「なぜこの技術が使われているのか」「各部分がどのように連携して動いているのか」を、可能な限り平易な言葉と比喩を用いて説明すること。
*   ソフトウェア開発の前提知識がない方でも、アプリケーションの全体像と基本的な仕組みを掴めるようにすること。
*   用語集も、技術的な正確さを保ちつつ、初心者向けの解説を加えることで、理解の助けとなるようにすること。

この解説書が、`simplechat` プロジェクトへの理解を深める一助となれば幸いです。もし不明な点があれば、用語集を参照したり、さらに質問したりしてみてください。

--- END OF REVISED FILE 解説書.md ---

